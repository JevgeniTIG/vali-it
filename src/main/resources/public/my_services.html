<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>My Services</title>
    <link rel="stylesheet" href="styles.css">



</head>
<body>
<div class="header">
    <br><img src="logo.png" alt="logo"/></br>
    <br class="navigation">
    <br><span style="padding-left:800px"></span>
    <a><button onclick="location.href='index.html'">Log out</button></a></br>

    </br>

</div>

<!Welcomes customer>
<span id="helloMessage"></span>
<button onclick="location.href='add_service.html'">Add New Service</button>
<div id="myServicesTable"></div>
<div><img src="pic_carousel_1.jpg" ></div>
</body>

<script>

    fetch('/welcome_host', {
        method: 'POST',
        cache: 'no-cache',
        headers: {
            'Content-Type': 'application/json'
        }
    })
        .then(function (response) {
            return response.json();
        })
        .then(function (jsonData) {
            var html = '<span>';
            for (var i = 0; i < jsonData.length; ++i) {
                var item = jsonData[i];
                html += item.hostName;
                html += ' ';
                html += item.hostLastName;
                html += '!';
            }
            html += '</span>'
            helloMessage.innerHTML = 'Welcome, ' + html;

        })

        .catch(function (err) {
            console.log(err);
            alert('oops');
        });


    // Shows services of the host that is currently logged
    //let myServicesButton = document.getElementById("statementButton")
    //myServicesButton.addEventListener('click', function showStatement() {

        fetch('/show_logged_host_services', {
            method: 'POST',
            cache: 'no-cache',
            headers: {
                'Content-Type': 'application/json'
            }
        })

            .then(function (response) {
                return response.json();
            })

            .then(function (jsonData) {

                var html = '<table>';
                html += '<tr>';
                html += '<td><b>SERVICE</b></td>';
                html += '<td><b>SERVICE DESCRIPTION</b></td>';
                html += '<td><b>DURATION</b></td>';
                html += '<td><b>PRICE</b></td>';
                html += '<td><b>PAYMENT METHOD</b></td>';
                html += '<td><b>ROOM TYPE</b></td>';
                html += '<td><b>LOCATION</b></td>';
                html += '<td><b></b></td>';
                html += '</tr>';
                for (var i = 0; i < jsonData.length; ++i) {
                    var item = jsonData[i];
                    html += '<tr>';
                    html += '<td>'+item.serviceName+'</td>';
                    html += '<td>'+item.serviceDescription+'</td>';
                    html += '<td>'+item.serviceDuration+'</td>';
                    html += '<td>'+item.servicePrice+'</td>';
                    html += '<td>'+item.servicePaymentMethod+'</td>';
                    html += '<td>'+item.serviceRoomType+'</td>';
                    html += '<td>'+item.serviceAddress+'</td>';
                    html += '<td><input type="button" value="Delete" ' +
                        'onclick="deleteButtonFunction('+item.serviceId+')"></td>';
                    html += '</tr>';
                }
                html += '</table>';
                myServicesTable.innerHTML = html;

            })
            .catch(function (err) {
                alert('Error');


    });

        function deleteButtonFunction(rowNum){
            deleteRowFunction();
            deleteService(rowNum);
        }

    //Deletes a row from browser
    function deleteRowFunction() {
        // event.target will be the input element.
        var td = event.target.parentNode;
        var tr = td.parentNode; // the row to be removed
        tr.parentNode.removeChild(tr);
    }


    //Deletes a service from table 'services'
    function deleteService(num) {

        fetch('/delete_service', {
            method: 'POST',
            cache: 'no-cache',
            headers: {
                'Content-Type': 'application/json'
            },

            body: JSON.stringify({

                serviceId: num

            })
        })
    }





</script>
</html>