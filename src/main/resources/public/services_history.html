<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Services History</title>
    <link rel="stylesheet" href="styles.css">


</head>
<body>
<div class="header">
    <img src="logo.png" alt="logo"/>
    <div class="header-right">
        <!Welcomes customer>
        <div id="helloMessage"></div>
        <button id="hostButton1" onclick="location.href='index.html'">Log out</button>
        <button id="showMyServicesHistoryButton" onclick="location.href='member_page.html'">Find Service</button>
    </div>
</div>

<div id="checkMember"></div>


<div class="container">
    <img src="images/member_page_background.jpg" >
    <div class="overlay">

    <div id="servicesHistory"></div>
    </div>
</div>

</body>

<script>
    var currentUser;
    fetch('/welcome_host', {
        method: 'POST',
        cache: 'no-cache',
        headers: {
            'Content-Type': 'application/json'
        }
    })
        .then(function (response) {
            return response.json();
        })
        .then(function (jsonData) {
            var html = '<span>';
            for (var i = 0; i < jsonData.length; ++i) {
                var item = jsonData[i];
                html += item.hostName;
                html += ' ';
                html += item.hostLastName;
                html += '!';
                currentUser = item.hostRole;
            }
            html += '</span>'
            helloMessage.innerHTML = 'Welcome, ' + html;
            checkMemberRole();
        })


        .catch(function (err) {
            console.log(err);
            alert('oops');
        });

    // Checks if currently logged member is also a host. If yes >>> changes interface and functionality of member_page.html
    function checkMemberRole(){
        if(currentUser == 'member'){
            becomeHost();

        }
        else if(currentUser =='member and host'){
            addNewService();
            showMyServices();
        }
    }

    // Adds a button 'Become a host'
    function becomeHost(){
        var button = document.createElement("button");
        button.id = "hostButton1";
        button.innerHTML = "Become a host";

        var div = document.getElementsByTagName("div")[0];
        div.appendChild(button);


        button.addEventListener ("click", function common(){
            location.href= "host_register_page.html"

        });
    }

    // Adds a button 'Add Service'
    function addNewService(){
        var button = document.createElement("button");
        button.id = "hostButton1";
        button.innerHTML = "Add New Service";

        var div = document.getElementsByTagName("div")[3];
        div.appendChild(button);


        button.addEventListener ("click", function common(){
            location.href= "add_service.html"

        });
    }

    // Adds a button 'Add Service'
    function showMyServices(){
        var button = document.createElement("button");
        button.id = "hostButton1";
        button.innerHTML = "My Services";

        var div = document.getElementsByTagName("div")[2];
        div.appendChild(button);


        button.addEventListener ("click", function common(){
            location.href= "my_services.html"

        });
    }

    var serviceNumber;
    var result;
    //Shows services history of logged member on the same page
        fetch('/show_logged_member_services_history', {
            method: 'POST',
            cache: 'no-cache',
            headers: {
                'Content-Type': 'application/json'
            }
        })

            .then(function (response) {
                return response.json();
            })

            .then(function (jsonData) {

                var html = '<table class="myServicesHistoryTable">';
                html += '<tr class="firstTr">';
                html += '<td><b>NAME</b></td>';
                html += '<td><b>RATING</b></td>';
                html += '<td><b>DESCRIPTION</b></td>';
                html += '<td><b></b></td>';
                html += '<td><b></b></td>';
                html += '<td><b></b></td>';
                html += '<td><b></b></td>';
                html += '<td style="color:#df2161"><b>RATE HOST</b></td>';
                html += '</tr>';

                for (var i = 0; i < jsonData.length; ++i) {
                    var item = jsonData[i];
                    serviceNumber=item.serviceId;
                    getRating(serviceNumber);

                    html += '<tr>';
                    html += '<td>' + item.serviceFullName + '</td>';

                    if (item.serviceRating == null || item.serviceRating==0){
                        html += '<td style="color: #df2161">not rated yet</td>';
                    }else if(item.serviceRating == 0.5){
                        html += '<td><img src="images/rating/half_star.png" class="rating_image"/></td>';
                    }
                    else if(item.serviceRating == 1){
                        html += '<td><img src="images/rating/1star_rating.png" class="rating_image"/></td>';
                    }
                    else if(item.serviceRating == 1.5){
                        html += '<td><img src="images/rating/one_and_half_star.png" class="rating_image"/></td>';
                    }
                    else if(item.serviceRating == 2){
                        html += '<td><img src="images/rating/2star_rating.png" class="rating_image"/></td>';
                    }
                    else if(item.serviceRating == 2.5){
                        html += '<td><img src="images/rating/two_and_half_star.png" class="rating_image"/></td>';
                    }
                    else if(item.serviceRating == 3){
                        html += '<td><img src="images/rating/3star_rating.png" class="rating_image"/></td>';
                    }
                    else if(item.serviceRating == 3.5){
                        html += '<td><img src="images/rating/three_and_half_star.png" class="rating_image"/></td>';
                    }
                    else if(item.serviceRating == 4){
                        html += '<td><img src="images/rating/4star_rating.png" class="rating_image"/></td>';
                    }
                    else if(item.serviceRating == 4.5){
                        html += '<td><img src="images/rating/four_and_half_star.png" class="rating_image"/></td>';
                    }
                    else if(item.serviceRating == 5){
                        html += '<td><img src="images/rating/5star_rating.png" class="rating_image"/></td>';
                    }
                    html += '<td>' + item.serviceDescription + '</td>';
                    html += '<td></td>';
                    html += '<td></td>';
                    html += '<td></td>';
                    html += '<td></td>';
                    html += '<td><img src="images/rating/star_black_left_half.png" onmouseover="hoverLeft(this);" onmouseout="unhoverLeft(this);" class="rating_image_onestar" id="firstImage'+i+'" onclick="rateServiceHostHalfStar('+serviceNumber+')"/>' +
                        '<img src="images/rating/star_black_right_half.png" onmouseover="hoverRight(this);" onmouseout="unhoverRight(this);" class="rating_image_onestar" id="secondImage'+i+'" onclick="rateServiceHostOneStar('+serviceNumber+')"/>' +
                        '<img src="images/rating/star_black_left_half.png" onmouseover="hoverLeft(this);" onmouseout="unhoverLeft(this);" class="rating_image_onestar" id="thirdImage'+i+'" onclick="rateServiceHostOneAndHalfStar('+serviceNumber+')"/>' +
                        '<img src="images/rating/star_black_right_half.png" onmouseover="hoverRight(this);" onmouseout="unhoverRight(this);" class="rating_image_onestar" id="fourthImage'+i+'" onclick="rateServiceHostTwoStar('+serviceNumber+')"/>' +
                        '<img src="images/rating/star_black_left_half.png" onmouseover="hoverLeft(this);" onmouseout="unhoverLeft(this);" class="rating_image_onestar" id="fifthImage'+i+'" onclick="rateServiceHostTwoAndHalfStar('+serviceNumber+')"/>' +
                        '<img src="images/rating/star_black_right_half.png" onmouseover="hoverRight(this);" onmouseout="unhoverRight(this);" class="rating_image_onestar" id="firstImage'+i+'" onclick="rateServiceHostThreeStar('+serviceNumber+')"/>' +
                        '<img src="images/rating/star_black_left_half.png" onmouseover="hoverLeft(this);" onmouseout="unhoverLeft(this);" class="rating_image_onestar" id="secondImage'+i+'" onclick="rateServiceHostThreeAndHalfStar('+serviceNumber+')"/>' +
                        '<img src="images/rating/star_black_right_half.png" onmouseover="hoverRight(this);" onmouseout="unhoverRight(this);" class="rating_image_onestar" id="thirdImage'+i+'" onclick="rateServiceHostFourStar('+serviceNumber+')"/>' +
                        '<img src="images/rating/star_black_left_half.png" onmouseover="hoverLeft(this);" onmouseout="unhoverLeft(this);" class="rating_image_onestar" id="fourthImage'+i+'" onclick="rateServiceHostFourAndHalfStar('+serviceNumber+')"/>' +
                        '<img src="images/rating/star_black_right_half.png" onmouseover="hoverRight(this);" onmouseout="unhoverRight(this);" class="rating_image_onestar" id="fifthImage'+i+'" onclick="rateServiceHostFiveStar('+serviceNumber+')"/></td>';
                    html += '</tr>';

                }
                html += '</table>';
                servicesHistory.innerHTML = html;


            })
            .catch(function (err) {
                alert('Error');

            })


    function hoverLeft(element) {
        element.setAttribute('src', 'images/rating/star_pink_left_half.png');
    }

    function unhoverLeft(element) {
        element.setAttribute('src', 'images/rating/star_black_left_half.png');
    }

    function hoverRight(element) {
        element.setAttribute('src', 'images/rating/star_pink_right_half.png');
    }

    function unhoverRight(element) {
        element.setAttribute('src', 'images/rating/star_black_right_half.png');
    }


    //Get rating
    function getRating(numOfService){
        fetch('/get_rating', {
            method: 'POST',
            cache: 'no-cache',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({
                serviceId: numOfService
            })
        })

            .then(function (response) {

            })

            .catch(function (err) {
                alert("Something went wrong");
            });
    }

////////// Rating section
    function rateServiceHostHalfStar(numOfService){
        fetch('/update_rating', {
            method: 'POST',
            cache: 'no-cache',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({
                serviceRating: 0.5,
                serviceId: numOfService


            })
        })

            .then(function (response) {
                alert("Thank You")
            })

            .catch(function (err) {
                alert("Something went wrong");
            });
    }

    function rateServiceHostOneStar(numOfService){
        fetch('/update_rating', {
            method: 'POST',
            cache: 'no-cache',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({
                serviceRating: 1,
                serviceId: numOfService

            })
        })

            .then(function (response) {
                alert("Thank You")
            })

            .catch(function (err) {
                alert("Something went wrong");
            });
    }

    function rateServiceHostOneAndHalfStar(numOfService){
        fetch('/update_rating', {
            method: 'POST',
            cache: 'no-cache',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({
                serviceRating: 1.5,
                serviceId: numOfService

            })
        })

            .then(function (response) {
                alert("Thank You")
            })

            .catch(function (err) {
                alert("Something went wrong");
            });
    }

    function rateServiceHostTwoStar(numOfService){
        fetch('/update_rating', {
            method: 'POST',
            cache: 'no-cache',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({
                serviceRating: 2,
                serviceId: numOfService

            })
        })

            .then(function (response) {
                alert("Thank You")
            })

            .catch(function (err) {
                alert("Something went wrong");
            });
    }

    function rateServiceHostTwoAndHalfStar(numOfService){
        fetch('/update_rating', {
            method: 'POST',
            cache: 'no-cache',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({
                serviceRating: 2.5,
                serviceId: numOfService

            })
        })

            .then(function (response) {
                alert("Thank You")
            })

            .catch(function (err) {
                alert("Something went wrong");
            });
    }

    function rateServiceHostThreeStar(numOfService){
        fetch('/update_rating', {
            method: 'POST',
            cache: 'no-cache',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({
                serviceRating: 3,
                serviceId: numOfService


            })
        })

            .then(function (response) {
                alert("Thank You")
            })

            .catch(function (err) {
                alert("Something went wrong");
            });
    }

    function rateServiceHostThreeAndHalfStar(numOfService){
        fetch('/update_rating', {
            method: 'POST',
            cache: 'no-cache',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({
                serviceRating: 3.5,
                serviceId: numOfService

            })
        })

            .then(function (response) {
                alert("Thank You")
            })

            .catch(function (err) {
                alert("Something went wrong");
            });
    }

    function rateServiceHostFourStar(numOfService){
        fetch('/update_rating', {
            method: 'POST',
            cache: 'no-cache',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({
                serviceRating: 4,
                serviceId: numOfService

            })
        })

            .then(function (response) {
                alert("Thank You")
            })

            .catch(function (err) {
                alert("Something went wrong");
            });
    }

    function rateServiceHostFourAndHalfStar(numOfService){
        fetch('/update_rating', {
            method: 'POST',
            cache: 'no-cache',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({
                serviceRating: 4.5,
                serviceId: numOfService

            })
        })

            .then(function (response) {
                alert("Thank You")
            })

            .catch(function (err) {
                alert("Something went wrong");
            });
    }

    function rateServiceHostFiveStar(numOfService){
        fetch('/update_rating', {
            method: 'POST',
            cache: 'no-cache',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({
                serviceRating: 5,
                serviceId: numOfService

            })
        })

            .then(function (response) {
                alert("Thank You")
            })

            .catch(function (err) {
                alert("Something went wrong");
            });
    }

/*
    function checkIfExists(numOfService) {
        //Shows services history of logged member on the same page
        fetch('/check_if_experienced_service_exists', {
            method: 'POST',
            cache: 'no-cache',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({

                serviceId: numOfService

            })
        })

            .then(function (response) {
                return response.json();
            })

            .then(function (jsonData) {
                if(jsonData.length == 0){
                    result = true;
                }

            })

            .catch(function (err) {
                alert('Error');

            })
    }

*/

</script>
</html>