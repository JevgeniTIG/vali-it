<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Internet Bank admin_mode</title>
    <link rel="stylesheet" href="styles.css">


</head>
<body>
<img src="mrb_header.jpg" width="1200" height="120">

<h5>
</h5>
<form>
    <!Welcomes customer>
    <span id="helloMessage"></span>
    <span style="padding-left:800px"></span>
    <input class="button-function" type="button" id="logOut" onclick="location.href='index.html'"
           value="Log Out" style="height:20px;width=60px">

</form>

<h5>
</h5>
<form>
    <!Gets balance of specified account>
    <input type="text" id="yourBalance" placeholder="Account Number">
    <input class="button-function" type="button" id="getBalance" value="Show Balance">
    <input type="text" id="yourBalanceOutput">


</form>
<h5>
</h5>
<form>
    <!Deposits money to specified account>
    <input type="text" id="receiverAccount" placeholder="Account Number">
    <input type="text" id="amountToDeposit" placeholder="Amount">
    <input class="button-function" type="button" id="depositButton" value="Deposit">
</form>
<h5>
</h5>
<form>
    <!Withdraws money from specified account>
    <input type="text" id="payerAccount" placeholder="Account Number">
    <input type="text" id="amountToWithdraw" placeholder="Amount">
    <input class="button-function" type="button" id="withdrawButton" value="Withdraw">
</form>
<h5>
</h5>
<form>
    <!Transfers money between accounts>
    <input type="text" id="accountFrom" placeholder="Payer's account">
    <input type="text" id="accountTo" placeholder="Receiver's account">
    <input type="text" id="amountToTransfer" placeholder="Amount">
    <input class="button-function" type="button" id="transferButton" value="Transfer">
</form>
<h5>
</h5>
<form>
    <!Shows account balance>
    <input type="text" id="accountId" placeholder="Account ID">
    <input class="button-function" type="button" id="statementButton" value="Show Statement">

</form>


<div id="tableOfTransactions">

</div>
</body>

<script>
    // Welcomes customer


        fetch('/welcome_user', {
            method: 'POST',
            cache: 'no-cache',
            headers: {
                'Content-Type': 'application/json'
            }
            })
        .then(function (response) {
            return response.json();
        })
        .then(function (jsonData) {
            var html = '<span>';
			for (var i = 0; i < jsonData.length; ++i) {
				var item = jsonData[i];
                html += item.firstName;
                html += ' ';
                html += item.lastName;
                html += '!';
            }
            html += '</span>'
            helloMessage.innerHTML = 'Welcome, ' + html;

        })


        .catch(function (err) {
            console.log(err);
            alert('oops');
        });



    // Gets balance of specified account
    let submitButton = document.getElementById("getBalance")
    submitButton.addEventListener('click', function getBalance() {

        fetch('/getbalance_efficient', {
            method: 'POST',
            cache: 'no-cache',
            headers: {
                'Content-Type': 'application/json'
            },
				body: JSON.stringify({
					account: yourBalance.value,

				})
            })

        .then(function (response) {
            return response.json();
        })
        .then(function (jsonData) {
            yourBalanceOutput.value = jsonData;

        })
        .catch(function (err) {
            yourBalanceOutput.value = 'You are trying to access classified data';
        });

    });

    // Deposits money to specified account
    let depositButton = document.getElementById("depositButton")
    depositButton.addEventListener('click', function depositAccount() {

        fetch('/deposit_efficient', {
            method: 'PUT',
            cache: 'no-cache',
            headers: {
                'Content-Type': 'application/json'
            },
				body: JSON.stringify({
					account: receiverAccount.value,
					amount: amountToDeposit.value

				})
            })

        .then(function (response) {
            depositButton.value = 'Transaction complete';
            receiverAccount.value = ' ';
            amountToDeposit.value = ' ';
        })


        .catch(function (err) {
            depositButton.value = 'You are trying to access classified data';
        });

    });

    // Withdraws money from specified account
    let withdrawButton = document.getElementById("withdrawButton")
    withdrawButton.addEventListener('click', function withdrawAccount() {

        fetch('/withdraw_efficient', {
            method: 'PUT',
            cache: 'no-cache',
            headers: {
                'Content-Type': 'application/json'
            },
				body: JSON.stringify({
					account: payerAccount.value,
					amount: amountToWithdraw.value

				})
            })

        .then(function (response) {
            withdrawButton.value = 'Transaction complete';
            payerAccount.value = ' ';
            amountToWithdraw.value = ' ';
        })


        .catch(function (err) {
            withdrawButton.value = 'You are trying to access classified data';
        });

    });


    // Transfers money between accounts
    let transferButton = document.getElementById("transferButton")
    transferButton.addEventListener('click', function transferAccount() {

        fetch('/transfer_efficient', {
            method: 'PUT',
            cache: 'no-cache',
            headers: {
                'Content-Type': 'application/json'
            },
				body: JSON.stringify({
					accountFrom: accountFrom.value,
					accountTo: accountTo.value,
					amount: amountToTransfer.value

				})
            })

        .then(function (response) {
            transferButton.value = 'Transaction complete';
            accountFrom.value = ' ';
            accountTo.value = ' ';
            amountToTransfer.value = ' ';
        })

        .catch(function (err) {
            transferButton.value = 'You are trying to access classified data';
        });

    });


// Shows account statement
    let statementButton = document.getElementById("statementButton")
    statementButton.addEventListener('click', function showStatement() {

        fetch('/showstatement_efficient', {
            method: 'POST',
            cache: 'no-cache',
            headers: {
                'Content-Type': 'application/json'
            },
				body: JSON.stringify({
					accountId: accountId.value,

				})
            })

        .then(function (response) {
            return response.json();
        })

        .then(function (jsonData) {

            var html = '<table>';
			html += '<tr>';
            html += '<td><b>ACCOUNT</b></td>';
            html += '<td><b>DEPOSIT</b></td>';
            html += '<td><b>WITHDRAW</b></td>';
            html += '<td><b>BALANCE</b></td>';
			html += '</tr>';
			for (var i = 0; i < jsonData.length; ++i) {
				var item = jsonData[i];
			    html += '<tr>';
                html += '<td>'+item.account+'</td>';
                if(item.deposit == null){
                    html += '<td></td>';
                } else {
                    html += '<td>'+item.deposit+'</td>';
                }
                if(item.withdraw == null){
                    html += '<td></td>';
                } else {
                    html += '<td>'+item.withdraw+'</td>';
                }
                html += '<td>'+item.balance+'</td>';
                html += '</tr>';
			}
			html += '</table>';
			tableOfTransactions.innerHTML = html;

        })
        .catch(function (err) {
            yourStatementOutput.value = 'You are trying to access classified data';
        });

    });


</script>
</html>