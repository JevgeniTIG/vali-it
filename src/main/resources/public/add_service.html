<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Add Service Page</title>
    <link rel="stylesheet" href="styles.css">

</head>
<body>
<div class="header">
    <img src="logo.png" alt="logo"/>
    <div class="header-right">
        <!Welcomes customer>
        <div id="helloMessage"></div>
        <button id="hostButton1" onclick="location.href='index.html'">Log out</button>
        <button id="showMyServicesButton" onclick="location.href='my_services.html'">My Services</button>
    </div>
</div>
<div class="container_addService">
    <img src="images/add_service_page_background.jpg" >
    <div class="overlay_picture_addService" id="addServiceTable">
        <table class="addServiceTable">
            <tr>
                <td>
                    <label for="chooseFromServices">Service:</label>
                    <select class="select_add_service_choose" name="service" id="chooseFromServices">
                        <option value="Choose">&nbspChoose&nbsp</option>
                        <option value="Massage">&nbspMassage&nbsp</option>
                        <option value="Haircut">&nbspHaircut&nbsp</option>
                        <option value="Nailcare">&nbspNailCare&nbsp</option>
                    </select>
                </td>

                <td>
                    <label for="serviceDescription">Service Description:</label>
                    <select class="select_add_service_description" name="serviceDescription" id="serviceDescription">;
                        <option value="Oil Massage">&nbspOil Massage&nbsp</option>
                        <option value="Thai Massage">&nbspThai Massage&nbsp</option>
                        <option value="Classic Massage">&nbspClassic Massage&nbsp</option>
                        <option value="Men Haircut">&nbspMen Haircut&nbsp</option>
                        <option value="Women Haircut">&nbspWomen Haircut&nbsp</option>
                        <option value="Kids Haircut">&nbspKids Haircut&nbsp</option>
                        <option value="Nail Polishing">&nbspPolishing NailCare&nbsp</option>
                        <option value="Nail Colouring">&nbspColouring NailCare&nbsp</option>
                    </select>
                </td>

                <td>
                    <label for="duration">Duration:</label>
                    <select class="select_add_service_duration" name="duration" id="duration">
                        <option value="30min">&nbsp30 min&nbsp</option>
                        <option value="45min">&nbsp45 min&nbsp</option>
                        <option value="60min">&nbsp60 min&nbsp</option>
                    </select>
                </td>
                <td>
                    <label for="addPrice" id="addPriceLabel">Price â‚¬:</label>
                    <input class="add_service_input_price" type="numeric" name="addPrice" id="addPrice">
                </td>
                <td>
                    <label for="paymentMethod">Payment Method:</label>
                    <select class="select_add_service_payment_method" name="paymentMethod" id="paymentMethod">
                        <option value="Cash">&nbspCash&nbsp</option>
                        <option value="Card">&nbspCard&nbsp</option>
                        <option value="Card & Cash">&nbspCard & Cash&nbsp</option>
                    </select>
                </td>
                <td>
                    <label for="roomType">Room Type:</label>
                    <select class="select_add_service_room_type" name="roomType" id="roomType">
                        <option value="Beauty Salon">&nbspBeauty Salon&nbsp</option>
                        <option value="Own Apartment">&nbspOwn Apartment&nbsp</option>
                    </select>
                </td>
                <td>
                    <label for="roomLocation" id="addLocationLabel">Location:</label>
                    <input class="add_service_input_location" type="text" id="roomLocation">
                </td>
                <td><input type="image" align="center" src="images/add_button.png"
                           onmouseover="this.src='images/add_button_active.png'"
                           onmouseout="this.src='images/add_button.png'"
                           id="add_new_service" href="#suitableService">
                </td>
            </tr>
        </table>
        <div id="addedMessage"></div>
        <div id="serviceAdded"></div>
    </div>
</div>



</body>
<script>

    (function() {
        const select = document.getElementsByName('serviceDescription'); //querySelectorAll('serviceDescription');
        const options = Array.from(select[0].options);
        const input = document.getElementById('chooseFromServices');
        function findMatches (search, options) {
            return options.filter(option => {
                const regex = new RegExp(search, "gi");
                return option.text.match(regex);
            });
        }
        function filterOptions () {
            options.forEach(option => {
                option.remove();
                option.selected = false;
            });
            const matchArray = findMatches(this.value, options);
            select[0].append(...matchArray);
        }
        input.addEventListener('change', filterOptions);

    })();




    // Adds new service into table 'services' and zero rating of just created service into table rating
    let addButton = document.getElementById("add_new_service")
    addButton.addEventListener('click', function addService() {
        add_a_service()
        create_a_service_rating()

    });


    function add_a_service(){
        fetch('/add_service', {
            method: 'POST',
            cache: 'no-cache',
            headers: {
                'Content-Type': 'application/json'
            },

            body: JSON.stringify({
                serviceName: chooseFromServices.value,
                serviceDescription: serviceDescription.value,
                serviceDuration: duration.value,
                servicePrice: addPrice.value,
                servicePaymentMethod: paymentMethod.value,
                serviceRoomType: roomType.value,
                serviceAddress: roomLocation.value,

            })
        })

            .then(function (response) {

                addPrice.value = ' ';
                roomLocation.value = ' ';

            })

            .catch(function (err) {
                alert('Something went wrong');
            });
    }

    function create_a_service_rating(){
        fetch('/create_rating', {
            method: 'POST',
            cache: 'no-cache',
            headers: {
                'Content-Type': 'application/json'
            }
        })

            .then(function (response) {

            })

            .catch(function (err) {
                alert('Something went wrong');
            })
    }


    addButton.addEventListener('click', function showJustAddedService() {
        if(chooseFromServices.value != 'Choose' && addPrice.value != 0 && roomLocation.value != '') {
            var html = '<table class="justAddedService">';
            html += '<tr>';
            html += '<td><b>SERVICE</b></td>';
            html += '<td><b>DESCRIPTION</b></td>';
            html += '<td><b>DURATION</b></td>';
            html += '<td><b>PRICE</b></td>';
            html += '<td><b>PAYMENT METHOD</b></td>';
            html += '<td><b>ROOM TYPE</b></td>';
            html += '<td><b>LOCATION</b></td>';
            html += '<td><b></b></td>';
            html += '<td><b></b></td>';
            html += '</tr>';
            html += '<tr>';
            html += '<td><b>' + chooseFromServices.value + '</b></td>';
            html += '<td><b>' + serviceDescription.value + '</b></td>';
            html += '<td><b>' + duration.value + '</b></td>';
            html += '<td><b>' + addPrice.value + '</b></td>';
            html += '<td><b>' + paymentMethod.value + '</b></td>';
            html += '<td><b>' + roomType.value + '</b></td>';
            html += '<td><b>' + roomLocation.value + '</b></td>';
            html += '<td><b></b></td>';
            html += '<td><b></b></td>';
            html += '</tr>';
            html += '</table>';
            serviceAdded.innerHTML = html;

        }
        else{
            alert('Please fill all necessary fields');
        }

    })


    fetch('/welcome_host', {
        method: 'POST',
        cache: 'no-cache',
        headers: {
            'Content-Type': 'application/json'
        }
    })
        .then(function (response) {
            return response.json();
        })
        .then(function (jsonData) {
            var html = '<span>';
            for (var i = 0; i < jsonData.length; ++i) {
                var item = jsonData[i];
                html += item.hostName;
                html += ' ';
                html += item.hostLastName;
                html += '!';
            }
            html += '</span>'
            helloMessage.innerHTML = 'Welcome, ' + html;

        })


        .catch(function (err) {
            console.log(err);
            alert('oops');
        });


</script>
</html>